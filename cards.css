let errors = 0;
let score = 0;
let time = 0;
let timerInterval;

let cardList = [
  "darkness",
  "double",
  "fairy",
  "fighting",
  "fire",
  "grass",
  "lightning",
  "metal",
  "psychic",
  "water"
];

let cardSet = [];
let board = [];
let rows = 4;
let columns = 5;
let card1 = null;
let card2 = null;

const flipSound = document.getElementById("flipSound");
const matchSound = document.getElementById("matchSound");
const errorSound = document.getElementById("errorSound");
const winSound = document.getElementById("winSound");
const bgMusic = document.getElementById("bgMusic");

const startBtn = document.getElementById("startBtn");
const restartBtn = document.getElementById("restartBtn");
const musicToggle = document.getElementById("musicToggle");

startBtn.addEventListener("click", startGame);
restartBtn.addEventListener("click", restartGame);
musicToggle.addEventListener("click", toggleMusic);

function startGame() {
  startBtn.disabled = true;
  restartBtn.disabled = false;

  resetStats();
  shuffleCards();
  createBoard();

  // Start timer
  timerInterval = setInterval(() => {
    time++;
    document.getElementById("timer").innerText = time + "s";
  }, 1000);

  // Start background music
  bgMusic.play();
}

function restartGame() {
  clearInterval(timerInterval);
  document.getElementById("board").innerHTML = "";
  board = [];
  startGame();
}

function resetStats() {
  errors = 0;
  score = 0;
  time = 0;
  card1 = null;
  card2 = null;
  document.getElementById("errors").innerText = "0";
  document.getElementById("score").innerText = "0";
  document.getElementById("timer").innerText = "0s";
}

function shuffleCards() {
  cardSet = cardList.concat(cardList); // duplicate for pairs
  for (let i = 0; i < cardSet.length; i++) {
    const j = Math.floor(Math.random() * cardSet.length);
    [cardSet[i], cardSet[j]] = [cardSet[j], cardSet[i]];
  }
}

function createBoard() {
  const boardContainer = document.getElementById("board");
  boardContainer.innerHTML = "";
  for (let r = 0; r < rows; r++) {
    board[r] = [];
    for (let c = 0; c < columns; c++) {
      const cardValue = cardSet.pop();
      board[r][c] = cardValue;

      const card = document.createElement("img");
      card.id = `${r}-${c}`;
      card.src = "back.jpg";
      card.classList.add("card");
      card.addEventListener("click", selectCard);
      boardContainer.append(card);
    }
  }
}

function selectCard() {
  if (this.src.includes("back")) {
    flipSound.play();
    if (!card1) {
      card1 = this;
      const [r, c] = this.id.split("-").map(Number);
      card1.src = board[r][c] + ".jpg";
    } else if (!card2 && this !== card1) {
      card2 = this;
      const [r, c] = this.id.split("-").map(Number);
      card2.src = board[r][c] + ".jpg";
      setTimeout(checkMatch, 800);
    }
  }
}

function checkMatch() {
  if (card1.src === card2.src) {
    matchSound.play();
    score += 10;
    document.getElementById("score").innerText = score;
    card1 = null;
    card2 = null;

    if (score === cardList.length * 10) {
      clearInterval(timerInterval);
      bgMusic.pause();
      winSound.play();
      alert("ðŸŽ‰ You matched all cards! Great job!");
    }
  } else {
    errorSound.play();
    card1.src = "back.jpg";
    card2.src = "back.jpg";
    errors++;
    document.getElementById("errors").innerText = errors;
    card1 = null;
    card2 = null;
  }
}

function toggleMusic() {
  if (bgMusic.paused) {
    bgMusic.play();
    musicToggle.textContent = "ðŸ”Š";
  } else {
    bgMusic.pause();
    musicToggle.textContent = "ðŸ”‡";
  }
}
